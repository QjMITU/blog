<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="the tianxia"><meta name="copyright" content="the tianxia"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>SpringBootå¯åŠ¨æµç¨‹---SpringApplicationç±» | thetianxia-å¤©ä¸‹</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" href="/blog/favicon.ico"><link rel="mask-icon" href="/blog/favicon.ico" color="#0078E7"><link rel="alternate icon" href="/blog/yun.ico"><link rel="preload" href="/blog/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/blog/js/utils.js" as="script"><link rel="preload" href="/blog/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/blog/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"github.com","root":"/blog/","title":"å¤©ä¸‹çš„çŸ¥è¯†åº“","version":"1.6.2","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"../data/sentences.json"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/blog/css/hexo-theme-yun.css"><script src="/blog/js/utils.js"></script><script src="/blog/js/hexo-theme-yun.js"></script><meta name="description" content="SpringBootå¯åŠ¨ç±» 2.4.5123456@SpringBootApplicationpublic class Application &amp;#123;    public static void main(String[] args) &amp;#123;        SpringApplication.run(Application.class);    &amp;#125;&amp;#125;  å¯åŠ¨ç±»çš„ä»£ç ">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBootå¯åŠ¨æµç¨‹---SpringApplicationç±»">
<meta property="og:url" content="https://github.com/2023/06/29/SpringBoot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%202.4.5/index.html">
<meta property="og:site_name" content="thetianxia-å¤©ä¸‹">
<meta property="og:description" content="SpringBootå¯åŠ¨ç±» 2.4.5123456@SpringBootApplicationpublic class Application &amp;#123;    public static void main(String[] args) &amp;#123;        SpringApplication.run(Application.class);    &amp;#125;&amp;#125;  å¯åŠ¨ç±»çš„ä»£ç ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707244415-ca15b7bd-6e71-471b-bc27-192825121f45.png#clientId=u3161bff8-e5eb-4&from=ui&id=u5f2c8608&originHeight=538&originWidth=1760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=150336&status=done&style=none&taskId=ueafcf95b-5dae-43de-a97d-eaaed68324f&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707256680-01107901-b44b-403d-96be-ba9999fd6380.png#clientId=u3161bff8-e5eb-4&from=ui&id=uaae5b1fa&originHeight=213&originWidth=933&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44655&status=done&style=none&taskId=ub731e35d-53a7-43ae-9cd4-e59adbbf89c&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707286433-3e175fda-4769-41b9-bf54-362e558f7f70.png#clientId=u3161bff8-e5eb-4&from=ui&id=u081ed975&originHeight=231&originWidth=1399&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46305&status=done&style=none&taskId=u654404b7-2a5d-4b6e-8ae3-31e7e2a8100&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707332947-72512475-726a-4d07-bfcd-401c74b5c61c.png#clientId=u3161bff8-e5eb-4&from=ui&id=u14381659&originHeight=146&originWidth=752&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22738&status=done&style=none&taskId=ucb01e8e8-edf2-46ed-90b1-243b71f5bf3&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707347381-8d0cf272-e12a-4249-9ad5-6c96d89164cd.png#clientId=u3161bff8-e5eb-4&from=ui&id=u6c25e29d&originHeight=760&originWidth=1907&originalType=binary&ratio=1&rotation=0&showTitle=false&size=222589&status=done&style=none&taskId=ub79ac6a8-d857-41b5-88e6-56d05ba26b6&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707358778-f4ddf3f8-5e27-4b8a-aed4-d798cb047294.png#clientId=u3161bff8-e5eb-4&from=ui&id=u19d3dc36&originHeight=574&originWidth=1439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=126189&status=done&style=none&taskId=u3db53c29-0a2a-4dd5-9879-aa81771515e&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707382722-084ec7c8-f506-468b-9e20-ae9986a92f3c.png#clientId=u3161bff8-e5eb-4&from=ui&id=u59ab0c73&originHeight=50&originWidth=1360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12858&status=done&style=none&taskId=u676e5e67-b8d3-4475-9f7a-6b2f828e676&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707396985-788c6c9e-9fad-4a48-a55b-34c3c2a61ce1.png#clientId=u3161bff8-e5eb-4&from=ui&id=u60d2f3ce&originHeight=490&originWidth=1260&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85844&status=done&style=none&taskId=uca283398-c36a-4555-b2d0-04a821bed7a&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707413705-c28056cc-4ab4-4f43-b47a-01bfe7b06fc6.png#clientId=u3161bff8-e5eb-4&from=ui&id=u8a9052e3&originHeight=595&originWidth=760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72886&status=done&style=none&taskId=u071a519c-9515-45d3-84c5-86a405fc2e5&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707429794-d3d2255d-1a3e-4d5d-b7be-6d677f223c12.png#clientId=u3161bff8-e5eb-4&from=ui&id=u970a9c57&originHeight=116&originWidth=1394&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18600&status=done&style=none&taskId=u7590f051-148b-4192-8d59-33a07f87943&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707447506-0c5e4a27-982e-40a7-a9f7-423686f75bbd.png#clientId=u3161bff8-e5eb-4&from=ui&id=ud927991f&originHeight=560&originWidth=1539&originalType=binary&ratio=1&rotation=0&showTitle=false&size=120459&status=done&style=none&taskId=uca59e8dd-4e97-4afb-b87f-ed96cde2820&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707474859-c2307092-dea0-4a59-9030-b6d7a7efc891.png#clientId=u3161bff8-e5eb-4&from=ui&id=uafc8dfd6&originHeight=423&originWidth=792&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47346&status=done&style=none&taskId=u60b99c75-1935-4fc0-8994-43dd3c38443&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707490647-830ebee3-6783-4ea0-b317-f9b9ce5139b2.png#clientId=u3161bff8-e5eb-4&from=ui&id=uaab2e543&originHeight=32&originWidth=688&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7838&status=done&style=none&taskId=ub8496735-f011-4947-a3ad-ad1d547476b&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707498828-28acb6e4-8ac3-45fb-a32c-b31b7e0d4bc7.png#clientId=u3161bff8-e5eb-4&from=ui&id=ua5c48529&originHeight=39&originWidth=606&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8066&status=done&style=none&taskId=u4e32e7f0-566a-4e4e-806d-3b98c9c9c83&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707510183-f97be380-a42d-4f69-99a3-57f650af4262.png#clientId=u3161bff8-e5eb-4&from=ui&id=u8844aa9b&originHeight=358&originWidth=1068&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59697&status=done&style=none&taskId=ua473673e-d44e-40bb-8b1e-044293a117a&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707529571-bcf7bd22-c98d-4284-b382-632c9e2068a4.png#clientId=u3161bff8-e5eb-4&from=ui&id=u91b5dd06&originHeight=258&originWidth=984&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51082&status=done&style=none&taskId=ubd4c3bdd-302c-46b4-a390-72eb29d7a56&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707544473-4a7247d1-2f0a-4674-874e-47577337e605.png#clientId=u3161bff8-e5eb-4&from=ui&id=ud5ef2459&originHeight=135&originWidth=1271&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29198&status=done&style=none&taskId=ubb1ed218-f910-446a-aa2a-0ae27df636b&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707563730-c4f7e793-bd23-40a2-aae0-027b2c8bd126.png#clientId=u3161bff8-e5eb-4&from=ui&id=uea4aa363&originHeight=61&originWidth=1390&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22110&status=done&style=none&taskId=u5aa1ea85-98f1-4bfa-90c0-4dec087f340&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707590869-0d1f8443-bc32-4fd7-ac5d-a8eb11dde247.png#clientId=u3161bff8-e5eb-4&from=ui&id=u1dbbdcc9&originHeight=183&originWidth=1126&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39883&status=done&style=none&taskId=uba0cbcb7-df2d-42de-84b8-ec451180980&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707599569-6f444165-c232-4ce8-b6c3-c51687a27704.png#clientId=u3161bff8-e5eb-4&from=ui&id=uf5b7e8ca&originHeight=62&originWidth=1133&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20474&status=done&style=none&taskId=u42f24274-3f32-4e87-8a89-5688b3497c4&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707608284-3064f3fc-5ed6-4e5d-a094-559c16db09bf.png#clientId=u3161bff8-e5eb-4&from=ui&id=u7eed0658&originHeight=319&originWidth=1712&originalType=binary&ratio=1&rotation=0&showTitle=false&size=73412&status=done&style=none&taskId=u236e0f2b-54cd-447c-a8ba-7c7d60a3e84&title=">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707617233-4ffc6250-6293-4672-8c64-c1c9a34d96ad.png#clientId=u3161bff8-e5eb-4&from=ui&id=uc20fb555&originHeight=552&originWidth=1371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95295&status=done&style=none&taskId=u26738e0a-c446-465b-8551-93e0b101f0a&title=">
<meta property="article:published_time" content="2023-06-29T10:51:34.381Z">
<meta property="article:modified_time" content="2023-06-29T10:54:51.580Z">
<meta property="article:author" content="the tianxia">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707244415-ca15b7bd-6e71-471b-bc27-192825121f45.png#clientId=u3161bff8-e5eb-4&from=ui&id=u5f2c8608&originHeight=538&originWidth=1760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=150336&status=done&style=none&taskId=ueafcf95b-5dae-43de-a97d-eaaed68324f&title="><script src="/blog/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/blog/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/blog/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/blog/about/" title="the tianxia"><img width="96" loading="lazy" src="/blog/images/head_boji.jpg" alt="the tianxia"><span class="site-author-status" title="å­¦ä¹ æŒ£å°é’±é’±">ğŸ˜¤</span></a><div class="site-author-name"><a href="/blog/about/">the tianxia</a></div><span class="site-name">thetianxia-å¤©ä¸‹</span><sub class="site-subtitle">åŠŸä¸å”æï¼Œç‰æ±äºæˆ</sub><div class="site-desciption">welcome to my blog,have a good time!</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/blog/" title="é¦–é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/blog/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">8</span></a></div><div class="site-state-item"><a href="/blog/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/blog/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">8</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://www.yuque.com/xiaocongbandoufu-suh9q" title="æˆ‘çš„è¯­é›€"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-yuque"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="1874712420@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://wpa.qq.com/msgrd?v=3&amp;uin=1874712420&amp;site=qq&amp;menu=yes" title="QQ" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/blog/albums/" title="æˆ‘çš„ç›¸å†Œ" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-gallery-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%90%AF%E5%8A%A8%E7%B1%BB-2-4-5"><span class="toc-number">1.</span> <span class="toc-text">SpringBootå¯åŠ¨ç±» 2.4.5</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringApplication%E6%9E%84%E9%80%A0%E5%99%A8-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.1.</span> <span class="toc-text">SpringApplicationæ„é€ å™¨,åˆå§‹åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%9A%E7%82%B91"><span class="toc-number">1.1.1.</span> <span class="toc-text">é”šç‚¹1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%9A%E7%82%B92"><span class="toc-number">1.1.2.</span> <span class="toc-text">é”šç‚¹2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run%E5%85%B7%E4%BD%93%E5%90%AF%E5%8A%A8"><span class="toc-number">1.2.</span> <span class="toc-text">Runå…·ä½“å¯åŠ¨</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%9A%E7%82%B93"><span class="toc-number">1.2.1.</span> <span class="toc-text">é”šç‚¹3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%9A%E7%82%B94"><span class="toc-number">1.2.2.</span> <span class="toc-text">é”šç‚¹4</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%9A%E7%82%B95"><span class="toc-number">1.2.3.</span> <span class="toc-text">é”šç‚¹5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%9A%E7%82%B96"><span class="toc-number">1.2.4.</span> <span class="toc-text">é”šç‚¹6</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%9A%E7%82%B97"><span class="toc-number">1.2.5.</span> <span class="toc-text">é”šç‚¹7</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%9A%E7%82%B98"><span class="toc-number">1.2.6.</span> <span class="toc-text">é”šç‚¹8</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://github.com/blog/2023/06/29/SpringBoot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%202.4.5/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="the tianxia"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="thetianxia-å¤©ä¸‹"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">SpringBootå¯åŠ¨æµç¨‹---SpringApplicationç±»</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2023-06-29 18:51:34" itemprop="dateCreated datePublished" datetime="2023-06-29T18:51:34+08:00">2023-06-29</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/blog/categories/%E5%8D%9A%E5%AE%A2/" style="--text-color:dimgray" itemprop="url" rel="index"><span itemprop="text">åšå®¢</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/blog/categories/%E5%8D%9A%E5%AE%A2/Java/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Java</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/blog/categories/%E5%8D%9A%E5%AE%A2/Java/%E6%BA%90%E7%A0%81/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">æºç </span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/blog/tags/SpringBoot/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">SpringBoot</span></a></span></div><div class="post-author"><span class="author-name">thetianxia</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h2 id="SpringBootå¯åŠ¨ç±»-2-4-5"><a href="#SpringBootå¯åŠ¨ç±»-2-4-5" class="headerlink" title="SpringBootå¯åŠ¨ç±» 2.4.5"></a>SpringBootå¯åŠ¨ç±» 2.4.5</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨ç±»çš„ä»£ç éå¸¸ç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨SpringBooté¡¹ç›®å¯åŠ¨ç±»åŠ ä¸Šæ³¨è§£@SpringBootApplicationï¼Œå³å¯æ ‡æ³¨è¯¥ç±»æ˜¯å¯åŠ¨ç±»ã€‚åœ¨è¯¥ç±»çš„mainæ–¹æ³•ä¸­è°ƒç”¨äº†</p>
<p>SpringApplication.run(Application.class)ï¼Œæ‰€ä»¥å¯åŠ¨æµç¨‹å°±åœ¨runä¸­ã€‚é€šè¿‡debugï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æºç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1ã€mainæ–¹æ³•è¿›æ¥ä¹‹åï¼Œè°ƒç”¨äº†è¿™ä¸ªrunæ–¹æ³•ï¼Œç„¶åè¿™ä¸ªrunåˆå°è£…äº†ä¸€ä¸‹å‚æ•°ï¼Œè°ƒç”¨å¦ä¸€ä¸ªé‡è½½æ–¹æ³•run</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt; primarySource, String... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> run(<span class="keyword">new</span> Class[]&#123;primarySource&#125;, args);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2ã€è¯¥runæ–¹æ³•ï¼Œé¦–å…ˆæ–°åˆ›å»ºä¸€ä¸ªSpringApplicationï¼Œè¯¥ç±»æ„é€ å™¨æ¥å—ä¸€ä¸ªå¯åŠ¨ç±»å‚æ•°å¯¹è±¡ï¼Œåœ¨æ„é€ å™¨ä¸­ï¼ŒSpringBootè¿›è¡Œäº†ä¸€ç³»åˆ—å‚æ•°åˆå§‹åŒ–ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt;[] primarySources, String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">new</span> SpringApplication(primarySources)).run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="SpringApplicationæ„é€ å™¨-åˆå§‹åŒ–"><a href="#SpringApplicationæ„é€ å™¨-åˆå§‹åŒ–" class="headerlink" title="SpringApplicationæ„é€ å™¨,åˆå§‹åŒ–"></a>SpringApplicationæ„é€ å™¨,åˆå§‹åŒ–</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3ã€runæ–¹æ³•åˆ›å»ºæ–°çš„SpringApplicationå¯¹è±¡ï¼Œè°ƒç”¨è¯¥æ„é€ å™¨ï¼Œè¯¥æ„é€ å™¨åˆè°ƒç”¨å¦ä¸€ä¸ªæ„é€ å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(Class&lt;?&gt;... primarySources)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//é»˜è®¤èµ„æºåŠ è½½å™¨ResourceLoaderä¸ºnull</span></span><br><span class="line">    <span class="keyword">this</span>((ResourceLoader)<span class="keyword">null</span>, primarySources);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//4ã€åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.sources = <span class="keyword">new</span> LinkedHashSet();		<span class="comment">//é…ç½®sources</span></span><br><span class="line">    <span class="keyword">this</span>.bannerMode = Mode.CONSOLE;		<span class="comment">//é…ç½®æ¨ªå¹…ï¼Œé»˜è®¤æ‰“å°åˆ°æ§åˆ¶å°ã€‚Modeæšä¸¾ OFFå…³é—­,CONSOLEæ§åˆ¶å°æ‰“å°,LOGæ—¥å¿—æ‰“å°;</span></span><br><span class="line">    <span class="keyword">this</span>.logStartupInfo = <span class="keyword">true</span>;		<span class="comment">//é…ç½®æ˜¯å¦å¼€å¯æ—¥å¿—ï¼Œé»˜è®¤å¼€å¯</span></span><br><span class="line">    <span class="keyword">this</span>.addCommandLineProperties = <span class="keyword">true</span>;		<span class="comment">//é…ç½®æ˜¯å¦æ·»åŠ å‘½ä»¤è¡Œå±æ€§ï¼Œé»˜è®¤å¼€å¯</span></span><br><span class="line">    <span class="keyword">this</span>.addConversionService = <span class="keyword">true</span>;		<span class="comment">//æ˜¯å¦æ·»åŠ è½¬æ¢æœåŠ¡ï¼Œé»˜è®¤å¼€å¯</span></span><br><span class="line">    <span class="keyword">this</span>.headless = <span class="keyword">true</span>;		<span class="comment">//headlessæ¨¡å¼</span></span><br><span class="line">    <span class="keyword">this</span>.registerShutdownHook = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">this</span>.additionalProfiles = Collections.emptySet();</span><br><span class="line">    <span class="keyword">this</span>.isCustomEnvironment = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.lazyInitialization = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">this</span>.applicationContextFactory = ApplicationContextFactory.DEFAULT;		</span><br><span class="line">    <span class="keyword">this</span>.applicationStartup = ApplicationStartup.DEFAULT;		<span class="comment">//DefaultApplicationStartup</span></span><br><span class="line">    <span class="keyword">this</span>.resourceLoader = resourceLoader;		<span class="comment">//null</span></span><br><span class="line">    Assert.notNull(primarySources, <span class="string">&quot;PrimarySources must not be null&quot;</span>);		<span class="comment">//å¦‚æœæ²¡æœ‰å¯åŠ¨ç±»ï¼Œå¯åŠ¨å¤±è´¥ã€‚primarySourcesä¸€èˆ¬åªæœ‰ä¸€ä¸ªå¯åŠ¨ç±»ï¼Œæˆ–è€…null</span></span><br><span class="line">    <span class="keyword">this</span>.primarySources = <span class="keyword">new</span> LinkedHashSet(Arrays.asList(primarySources));		<span class="comment">//ä¿å­˜ä¸»é…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();		<span class="comment">//åˆ¤æ–­webç±»å‹ï¼ŒSERVLET</span></span><br><span class="line">    <span class="keyword">this</span>.bootstrapRegistryInitializers = <span class="keyword">this</span>.getBootstrapRegistryInitializersFromSpringFactories();		<span class="comment">//è·å–æ‰€æœ‰çš„BootstrapRegistryInitializerå®ç°ç±»ä¿å­˜åœ¨List&lt;BootstrapRegistryInitializer&gt; bootstrapRegistryInitializersï¼Œé”šç‚¹1</span></span><br><span class="line">    <span class="keyword">this</span>.setInitializers(<span class="keyword">this</span>.getSpringFactoriesInstances(ApplicationContextInitializer.class));	<span class="comment">//ä»èµ„æºæ–‡ä»¶é…ç½®ApplicationContextInitializerå®ä¾‹å¹¶å­˜åœ¨List&lt;ApplicationContextInitializer&lt;?&gt;&gt; initializers;é”šç‚¹2</span></span><br><span class="line">    <span class="keyword">this</span>.setListeners(<span class="keyword">this</span>.getSpringFactoriesInstances(ApplicationListener.class));		<span class="comment">//ä»èµ„æºæ–‡ä»¶åˆ›å»ºåº”ç”¨ç›‘å¬å™¨ï¼Œä¿å­˜åœ¨List&lt;ApplicationListener&lt;?&gt;&gt; listeners</span></span><br><span class="line">    <span class="keyword">this</span>.mainApplicationClass = <span class="keyword">this</span>.deduceMainApplicationClass();		<span class="comment">//é…ç½®åº”ç”¨çš„ä¸»æ–¹æ³•æ‰€åœ¨ç±»</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é”šç‚¹1"><a href="#é”šç‚¹1" class="headerlink" title="é”šç‚¹1"></a>é”šç‚¹1</h4><p>SpringBootå¯åŠ¨æ—¶åˆå§‹åŒ–ä¸Šä¸‹æ–‡æ—¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚å†æ”¹æ–¹æ³•ä¸­è·å–classLoaderï¼Œå› ä¸ºæ„é€ å™¨ä¸­resourceLoaderæ˜¯nullï¼Œæ‰€ä»¥å¾—åˆ°çš„æ˜¯é»˜è®¤æ„é€ å™¨</p>
<p>ç„¶åæ‰§è¡Œè¯¥æ–¹æ³•SpringFactoriesLoader.loadFactoryNames(type, classLoader)ï¼Œé”šç‚¹1ä¹‹åçš„æµç¨‹å¦‚ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getSpringFactoriesInstances(type, <span class="keyword">new</span> Class[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æœ€ç»ˆä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">Collection&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args)</span> </span>&#123;</span><br><span class="line">    ClassLoader classLoader = <span class="keyword">this</span>.getClassLoader();		<span class="comment">//return this.resourceLoader != null ? this.resourceLoader.getClassLoader() : 		ClassUtils.getDefaultClassLoader();è¿”å›ç³»ç»Ÿé»˜è®¤ç±»åŠ è½½å™¨</span></span><br><span class="line">    Set&lt;String&gt; names = <span class="keyword">new</span> LinkedHashSet(SpringFactoriesLoader.loadFactoryNames(type, classLoader));</span><br><span class="line">    List&lt;T&gt; instances = <span class="keyword">this</span>.createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</span><br><span class="line">    AnnotationAwareOrderComparator.sort(instances);</span><br><span class="line">    <span class="keyword">return</span> instances;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åè¿›å…¥SpringFactoriesLoader.loadFactoryNames(type, classLoader)ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryType, <span class="meta">@Nullable</span> ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">    ClassLoader classLoaderToUse = classLoader;		<span class="comment">//é»˜è®¤åŠ è½½å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">        classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String factoryTypeName = factoryType.getName();		<span class="comment">//é”šç‚¹1å¤„æ˜¯BootstrapRegistryInitializer.classç±»çš„å…¨ç±»å</span></span><br><span class="line">    <span class="keyword">return</span> (List)loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è·å¾—å…¨ç±»åä¹‹åï¼Œè¿›å…¥loadSpringFactories(classLoaderToUse)æ–¹æ³•ï¼Œå¹¶å¾—åˆ°ä¸€ä¸ªMapç±»ã€‚è¯¥æ–¹æ³•ä¼šä»â€META-INF/spring.factoriesâ€ä¸‹çš„æ–‡ä»¶ä¸­è¯»å–é…ç½®ã€‚SpringBootä¸­åªæœ‰å¦‚å›¾ä¸‰ä¸ªè·¯å¾„ä¸‹å­˜åœ¨â€META-INF/spring.factoriesâ€ã€‚æˆ‘ä»¬ä»¥é”šç‚¹1çš„BootstrapRegistryInitializerä¸ºä¾‹ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707244415-ca15b7bd-6e71-471b-bc27-192825121f45.png#clientId=u3161bff8-e5eb-4&from=ui&id=u5f2c8608&originHeight=538&originWidth=1760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=150336&status=done&style=none&taskId=ueafcf95b-5dae-43de-a97d-eaaed68324f&title=" alt="1.png" loading="lazy"></p>
<p>urlsä¸­å­˜åœ¨3ä¸ªåœ°å€ï¼Œåˆ†åˆ«åœ¨spring-bootï¼Œspring-boot-autoconfigureï¼Œspring-beansä¸­ã€‚å¾ªç¯å°†å¯¹åº”åœ°å€çš„æ–‡ä»¶è¯»å…¥ä¸ºpropertiesï¼Œå†…å®¹å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707256680-01107901-b44b-403d-96be-ba9999fd6380.png#clientId=u3161bff8-e5eb-4&from=ui&id=uaae5b1fa&originHeight=213&originWidth=933&originalType=binary&ratio=1&rotation=0&showTitle=false&size=44655&status=done&style=none&taskId=ub731e35d-53a7-43ae-9cd4-e59adbbf89c&title=" alt="2.png" loading="lazy"></p>
<p>å¦‚æœç¼“å­˜æ²¡æœ‰ï¼Œåˆ™è¯»å–é…ç½®æ–‡ä»¶ï¼Œè·å¾—Enumerationç±»å‹çš„urlsï¼ŒEnumerationçš„keyæ˜¯HashTableå¹¶ä¸”å¯¹åº”çš„å€¼ä¹Ÿå­˜äºHashTableä¸­ã€‚å› æ­¤è¯¥ç±»å°†é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹åšæ˜ å°„ã€‚ä¹‹åé€šè¿‡è¿­ä»£ï¼Œè·å¾—æ¯ä¸€ä¸ªkeyå’Œå¯¹åº”çš„valuesã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(ClassLoader classLoader) &#123;</span><br><span class="line">    <span class="comment">//å…ˆä»ç¼“å­˜è·å–ï¼Œå¦‚æœæœ‰å°±ç›´æ¥è¿”å›</span></span><br><span class="line">    Map&lt;String, List&lt;String&gt;&gt; result = (Map)cache.get(classLoader);</span><br><span class="line">    <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        HashMap result = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æ²¡æœ‰åˆ™ä»&quot;META-INF/spring.factories&quot;æ–‡ä»¶ä¸­è¯»å–ï¼Œè·å–&quot;META-INF/spring.factories&quot;çš„url</span></span><br><span class="line">            Enumeration urls = classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>);</span><br><span class="line">			<span class="comment">//éå†url</span></span><br><span class="line">            <span class="keyword">while</span>(urls.hasMoreElements()) &#123;</span><br><span class="line">                URL url = (URL)urls.nextElement();		</span><br><span class="line">                UrlResource resource = <span class="keyword">new</span> UrlResource(url);</span><br><span class="line">                Properties properties = PropertiesLoaderUtils.loadProperties(resource);		<span class="comment">//ä»urlä¸­è¯»å…¥æ•°æ®</span></span><br><span class="line">                Iterator var6 = properties.entrySet().iterator();		<span class="comment">//è·å¾—è¿­ä»£å™¨</span></span><br><span class="line">				<span class="comment">//è¿­ä»£</span></span><br><span class="line">                <span class="keyword">while</span>(var6.hasNext()) &#123;</span><br><span class="line">                    Entry&lt;?, ?&gt; entry = (Entry)var6.next();		<span class="comment">//Stringï¼ŒString</span></span><br><span class="line">                    String factoryTypeName = ((String)entry.getKey()).trim();		<span class="comment">//å»æ‰keyå­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½</span></span><br><span class="line">                    <span class="comment">//valueè½¬ä¸ºæ•°ç»„</span></span><br><span class="line">                    String[] factoryImplementationNames = StringUtils.commaDelimitedListToStringArray((String)entry.getValue());		<span class="comment">//å°†valueå­—ç¬¦è½¬ä¸ºæ•°ç»„</span></span><br><span class="line">                    String[] var10 = factoryImplementationNames;</span><br><span class="line">                    <span class="keyword">int</span> var11 = factoryImplementationNames.length;</span><br><span class="line">					</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> var12 = <span class="number">0</span>; var12 &lt; var11; ++var12) &#123;</span><br><span class="line">                        String factoryImplementationName = var10[var12];		</span><br><span class="line">                        ((List)result.computeIfAbsent(factoryTypeName, (key) -&gt; &#123;		<span class="comment">//ç¬¬ä¸€æ¬¡ä¼šè¿”å›ç©ºæ•°ç»„ï¼Œå¹¶å°†ç¬¬ä¸€ä¸ªå…ƒç´ å»æ‰å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½å¹¶æ·»åŠ åˆ°æ•°ç»„ï¼Œä¹‹åéƒ½è·å–è¯¥æ•°ç»„å¹¶å‘å…¶ä¸­æ·»åŠ å…ƒç´ ã€‚</span></span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">new</span> ArrayList();</span><br><span class="line">                        &#125;)).add(factoryImplementationName.trim());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">			</span><br><span class="line">            <span class="comment">//æœ€åå°†mapä¸­æ‰€æœ‰keyå¯¹åº”çš„valueå»é‡åæ›´æ–°</span></span><br><span class="line">            result.replaceAll((factoryType, implementations) -&gt; &#123;</span><br><span class="line">                <span class="keyword">return</span> (List)implementations.stream().distinct().collect(Collectors.collectingAndThen(Collectors.toList(), Collections::unmodifiableList));</span><br><span class="line">            &#125;);</span><br><span class="line">            cache.put(classLoader, result);		<span class="comment">//æ”¾å…¥ç¼“å­˜</span></span><br><span class="line">            <span class="keyword">return</span> result;		<span class="comment">//è¿”å›map</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var14) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unable to load factories from location [META-INF/spring.factories]&quot;</span>, var14);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›ä¹‹åï¼Œä¼šé€šè¿‡getOrDefaultæ–¹æ³•è¿”å›BootstrapRegistryInitializer.classå¯¹åº”çš„é…ç½®é›†åˆã€‚ç„¶åæ‰§è¡ŒList instances = this.createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</p>
<p>è¯¥æ–¹æ³•é€šè¿‡åå°„ï¼Œç”¨namesä¸­çš„å…¨éƒ¨ç±»çš„å…¨ç±»ååˆ›å»ºå®ä¾‹å¯¹è±¡é›†åˆï¼Œç„¶åæ’åºä¹‹åè¿”å›ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707286433-3e175fda-4769-41b9-bf54-362e558f7f70.png#clientId=u3161bff8-e5eb-4&from=ui&id=u081ed975&originHeight=231&originWidth=1399&originalType=binary&ratio=1&rotation=0&showTitle=false&size=46305&status=done&style=none&taskId=u654404b7-2a5d-4b6e-8ae3-31e7e2a8100&title=" alt="3.png" loading="lazy"></p>
<p>è¿”å›ä¹‹åï¼Œä¿å­˜åˆ°SpringApplicationå¯¹è±¡çš„å±æ€§ä¸­ã€‚</p>
<h4 id="é”šç‚¹2"><a href="#é”šç‚¹2" class="headerlink" title="é”šç‚¹2"></a>é”šç‚¹2</h4><p>åˆå§‹åŒ–BootstrapRegistryInitializer.classä¹‹åï¼Œä¼šåˆå§‹åŒ–ApplicationContextInitializerå’ŒApplicationListenerç›‘å¬å™¨ç›¸å…³çš„ç±»ã€‚è¿‡ç¨‹åŒé”šç‚¹1ä¸€æ ·ã€‚åªä¸è¿‡åœ¨loadSpringFactoriesæ–¹æ³•ä¸­ï¼Œä¼šç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„mapå¹¶è¿”å›å¯¹åº”çš„listã€‚</p>
<h3 id="Runå…·ä½“å¯åŠ¨"><a href="#Runå…·ä½“å¯åŠ¨" class="headerlink" title="Runå…·ä½“å¯åŠ¨"></a>Runå…·ä½“å¯åŠ¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">    StopWatch stopWatch = <span class="keyword">new</span> StopWatch();		<span class="comment">//è®¡æ—¶</span></span><br><span class="line">    stopWatch.start();</span><br><span class="line">    DefaultBootstrapContext bootstrapContext = <span class="keyword">this</span>.createBootstrapContext();</span><br><span class="line">    ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">this</span>.configureHeadlessProperty();</span><br><span class="line">    <span class="comment">//åˆ›å»ºå¹¶å¯åŠ¨ç›‘å¬å™¨</span></span><br><span class="line">    SpringApplicationRunListeners listeners = <span class="keyword">this</span>.getRunListeners(args);		<span class="comment">//é”šç‚¹3ï¼Œè·å–ç›‘å¬å™¨</span></span><br><span class="line">    listeners.starting(bootstrapContext, <span class="keyword">this</span>.mainApplicationClass);		<span class="comment">//é”šç‚¹4ï¼Œå¯åŠ¨ç›‘å¬å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span class="line">        ConfigurableEnvironment environment = <span class="keyword">this</span>.prepareEnvironment(listeners, bootstrapContext, applicationArguments);	<span class="comment">//é”šç‚¹7ï¼Œå‡†å¤‡ç¯å¢ƒ</span></span><br><span class="line">        <span class="keyword">this</span>.configureIgnoreBeanInfo(environment);</span><br><span class="line">        Banner printedBanner = <span class="keyword">this</span>.printBanner(environment);		<span class="comment">//æ ¹æ®é…ç½®æ‰“å°banner</span></span><br><span class="line">        <span class="comment">//åˆ›å»ºioc</span></span><br><span class="line">        context = <span class="keyword">this</span>.createApplicationContext();</span><br><span class="line">        context.setApplicationStartup(<span class="keyword">this</span>.applicationStartup);</span><br><span class="line">        <span class="keyword">this</span>.prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">        <span class="keyword">this</span>.refreshContext(context);</span><br><span class="line">        <span class="keyword">this</span>.afterRefresh(context, applicationArguments);</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">            (<span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)).logStarted(<span class="keyword">this</span>.getApplicationLog(), stopWatch);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        listeners.started(context);</span><br><span class="line">        <span class="keyword">this</span>.callRunners(context, applicationArguments);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var10) &#123;</span><br><span class="line">        <span class="keyword">this</span>.handleRunFailure(context, var10, listeners);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(var10);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        listeners.running(context);</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable var9) &#123;</span><br><span class="line">        <span class="keyword">this</span>.handleRunFailure(context, var9, (SpringApplicationRunListeners)<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(var9);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é”šç‚¹3"><a href="#é”šç‚¹3" class="headerlink" title="é”šç‚¹3"></a>é”šç‚¹3</h4><p>SpringApplicationRunListeners listeners = this.getRunListeners(args);è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒé‡è¦ï¼Œç›®çš„æ˜¯è·å–ä¸€ä¸ªå°è£…çš„SpringApplicationRunListenerså¯¹è±¡ã€‚è¯¥ç±»ä¸­ä¸€ä¸ªå±æ€§List listenersä¸­æœ€åä¼šæœ‰ä¸€ä¸ªå…ƒç´ EventPublishingRunListenerã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707332947-72512475-726a-4d07-bfcd-401c74b5c61c.png#clientId=u3161bff8-e5eb-4&from=ui&id=u14381659&originHeight=146&originWidth=752&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22738&status=done&style=none&taskId=ucb01e8e8-edf2-46ed-90b1-243b71f5bf3&title=" alt="4.png" loading="lazy"></p>
<p>ä¸‹é¢ï¼Œé€šè¿‡æ–­ç‚¹ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å°è£…è¿‡ç¨‹ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°getRunListenersç›´æ¥newäº†ä¸€ä¸ªSpringApplicationRunListenersã€‚ä¹‹åæˆ‘ä»¬çœ‹è¯¥æ„é€ å‡½æ•°ï¼Œç°åœ¨æˆ‘ä»¬å…ˆçœ‹å‚æ•°this.getSpringFactoriesInstances(SpringApplicationRunListener.class, types, this, args)æœ€åä¼šæ˜¯ä»€ä¹ˆã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> SpringApplicationRunListeners <span class="title">getRunListeners</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt;[] types = <span class="keyword">new</span> Class[]&#123;SpringApplication.class, String[].class&#125;;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpringApplicationRunListeners(logger, <span class="keyword">this</span>.getSpringFactoriesInstances(SpringApplicationRunListener.class, types, <span class="keyword">this</span>, args), <span class="keyword">this</span>.applicationStartup);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰SpringApplicationæ„é€ å…¶ä¸­ï¼Œå°±è§è¿‡å¤šæ¬¡ã€‚å®ƒä»ä¸€ä¸ªmapä¸­è·å–å¯¹åº”çš„Listé›†åˆã€‚æˆ‘ä»¬è¿›å»çœ‹ä¸€ä¸‹ï¼Œæœç„¶ï¼Œä¸€æ ·çš„é…æ–¹ã€‚æœ€ånamesåªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯EventPublishingRunListenerç±»çš„å…¨é™å®šç±»åã€‚ä¹‹ååˆè°ƒç”¨äº†List instances = this.createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);è¿™è¡Œä»£ç è¿›è¡Œåå°„è·å–å®ä¾‹ã€‚æœ€åä»£ç ä¼šè¿è¡Œåˆ°EventPublishingRunListenerçš„æ„é€ å™¨å¤„ã€‚æˆ‘ä»¬å¾€ä¸‹çœ‹ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707347381-8d0cf272-e12a-4249-9ad5-6c96d89164cd.png#clientId=u3161bff8-e5eb-4&from=ui&id=u6c25e29d&originHeight=760&originWidth=1907&originalType=binary&ratio=1&rotation=0&showTitle=false&size=222589&status=done&style=none&taskId=ub79ac6a8-d857-41b5-88e6-56d05ba26b6&title=" alt="5.png" loading="lazy"></p>
<p>æ ‡æ³¨çš„è¿™ä¸€è¡Œï¼Œå°†è¿‡å»çš„æ„é€ å‡½æ•°å’Œå‚æ•°ä¼ å…¥ï¼Œåå°„åˆ›å»ºå¯¹è±¡ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707358778-f4ddf3f8-5e27-4b8a-aed4-d798cb047294.png#clientId=u3161bff8-e5eb-4&from=ui&id=u19d3dc36&originHeight=574&originWidth=1439&originalType=binary&ratio=1&rotation=0&showTitle=false&size=126189&status=done&style=none&taskId=u3db53c29-0a2a-4dd5-9879-aa81771515e&title=" alt="6.png" loading="lazy"></p>
<p>ctorå°±æ˜¯ä¸Šä¸€æ­¥çš„ä¼ å…¥çš„æ„é€ å‡½æ•°ï¼Œè¿™é‡Œç›´æ¥ä¼ å…¥å‚æ•°å¼€å§‹æ„å»ºã€‚å‚æ•°ä¸­åŒ…å«çš„å°±æ˜¯ä¹‹å‰newçš„å¹¶ä¸”åˆå§‹åŒ–çš„SpringApplicationå¯¹è±¡ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707382722-084ec7c8-f506-468b-9e20-ae9986a92f3c.png#clientId=u3161bff8-e5eb-4&from=ui&id=u59ab0c73&originHeight=50&originWidth=1360&originalType=binary&ratio=1&rotation=0&showTitle=false&size=12858&status=done&style=none&taskId=u676e5e67-b8d3-4475-9f7a-6b2f828e676&title=" alt="7.png" loading="lazy"></p>
<p>è°ƒç”¨EventPublishingRunListeneræ„é€ å™¨åˆ›å»ºå¯¹è±¡ã€‚è¯¥ç±»æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œapplicationæ˜¯é€šè¿‡å‚æ•°ä¼ é€’çš„ï¼Œç”¨æ¥è·å–åˆå§‹åŒ–æ—¶åˆ›å»ºçš„ç›‘å¬å™¨å¯¹è±¡é›†åˆï¼Œå¹¶è·å–è¿­ä»£å™¨var3ã€‚ç„¶åå°†ç›‘å¬å™¨å°è£…åˆ°initialMulticasterå±æ€§ä¸­ã€‚initialMulticasterçš„ç±»å‹æ˜¯ public class SimpleApplicationEventMulticaster extends AbstractApplicationEventMulticasterï¼Œå®ƒçš„çˆ¶ç±»ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œè¯¥å†…éƒ¨ç±»ä¸­æœ‰ä¸€ä¸ªé›†åˆï¼Œæœ€ç»ˆè¿™äº›listenerä¼šå­˜åˆ°è¯¥é›†åˆä¸­ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707396985-788c6c9e-9fad-4a48-a55b-34c3c2a61ce1.png#clientId=u3161bff8-e5eb-4&from=ui&id=u60d2f3ce&originHeight=490&originWidth=1260&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85844&status=done&style=none&taskId=uca283398-c36a-4555-b2d0-04a821bed7a&title=" alt="8.png" loading="lazy"></p>
<p>å†…éƒ¨ç±»éƒ¨åˆ†ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addApplicationListener</span><span class="params">(ApplicationListener&lt;?&gt; listener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.defaultRetriever) &#123;</span><br><span class="line">            Object singletonTarget = AopProxyUtils.getSingletonTarget(listener);</span><br><span class="line">            <span class="keyword">if</span> (singletonTarget <span class="keyword">instanceof</span> ApplicationListener) &#123;</span><br><span class="line">                <span class="keyword">this</span>.defaultRetriever.applicationListeners.remove(singletonTarget);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.defaultRetriever.applicationListeners.add(listener);</span><br><span class="line">            <span class="keyword">this</span>.retrieverCache.clear();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å†…éƒ¨ç±»</span></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultListenerRetriever</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> Set&lt;ApplicationListener&lt;?&gt;&gt; applicationListeners;		<span class="comment">//æœ€ç»ˆå­˜æ”¾ç›‘å¬å™¨å¤„</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> Set&lt;String&gt; applicationListenerBeans;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">DefaultListenerRetriever</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.applicationListeners = <span class="keyword">new</span> LinkedHashSet();</span><br><span class="line">            <span class="keyword">this</span>.applicationListenerBeans = <span class="keyword">new</span> LinkedHashSet();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºåˆå§‹åŒ–ä¸€å…±æœ‰9ä¸ªç›‘å¬å™¨ï¼Œæ‰€ä»¥æœ€ç»ˆè¿™ä¸ªé›†åˆé‡Œé¢ä¼šæ·»åŠ 9ä¸ªç›‘å¬å™¨ã€‚å¦‚ä¸‹å›¾ï¼Œè¿”å›çš„å‚æ•°å°±æ˜¯instancesï¼Œé‡Œé¢å°è£…äº†ä¸€ä¸ªEventPublishingRunListenerï¼ŒEventPublishingRunListeneré‡Œé¢æœ‰ä¸ªå±æ€§initialMulticaster,é‡Œé¢åˆå°è£…äº†ä¸€ä¸ªåŒ…å«9ä¸ªç›‘å¬å™¨çš„é›†åˆã€‚å°è£…å¥—å¨ƒã€‚ã€‚ã€‚ã€‚æœ€åé€šè¿‡SpringApplicationRunListenersæ„é€ å‡½æ•°ï¼Œèµ‹å€¼ç»™listenersã€‚æœ€åè¿”å›ç”Ÿæˆçš„SpringApplicationRunListenerså¯¹è±¡ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707413705-c28056cc-4ab4-4f43-b47a-01bfe7b06fc6.png#clientId=u3161bff8-e5eb-4&from=ui&id=u8a9052e3&originHeight=595&originWidth=760&originalType=binary&ratio=1&rotation=0&showTitle=false&size=72886&status=done&style=none&taskId=u071a519c-9515-45d3-84c5-86a405fc2e5&title=" alt="9.png" loading="lazy"></p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œé”šç‚¹3ç»“æŸã€‚å¦‚æœå¥—çš„å¤´æ™•ï¼Œå»ºè®®å¤šçœ‹å‡ éå°±å¥½äº†ã€‚</p>
<h4 id="é”šç‚¹4"><a href="#é”šç‚¹4" class="headerlink" title="é”šç‚¹4"></a>é”šç‚¹4</h4><p>è·å¾—ç›‘å¬å™¨ä¹‹åï¼Œå¯åŠ¨ç›‘å¬å™¨ã€‚è¿™ä¸ªæ–¹æ³•æœ€åè°ƒç”¨äº†doWithListenersæ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡Œé¢å°†linstenersä¸­çš„ç›‘å¬å™¨ï¼ˆå…¶å®å°±æ˜¯EventPublishingRunListenerï¼‰åˆ†åˆ«æ‰§è¡Œlambdaä¸­listener.starting(bootstrapContext)ï¼Œæ‰€ä»¥æˆ‘ä»¬å»EventPublishingRunListenerä¸­æ‰¾å¯¹åº”çš„æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">starting</span><span class="params">(ConfigurableBootstrapContext bootstrapContext, Class&lt;?&gt; mainApplicationClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doWithListeners(<span class="string">&quot;spring.boot.application.starting&quot;</span>, (listener) -&gt; &#123;</span><br><span class="line">            listener.starting(bootstrapContext);</span><br><span class="line">        &#125;, (step) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (mainApplicationClass != <span class="keyword">null</span>) &#123;</span><br><span class="line">                step.tag(<span class="string">&quot;mainApplicationClass&quot;</span>, mainApplicationClass.getName());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doWithListeners</span><span class="params">(String stepName, Consumer&lt;SpringApplicationRunListener&gt; listenerAction, Consumer&lt;StartupStep&gt; stepAction)</span> </span>&#123;</span><br><span class="line">        StartupStep step = <span class="keyword">this</span>.applicationStartup.start(stepName);</span><br><span class="line">        <span class="keyword">this</span>.listeners.forEach(listenerAction);</span><br><span class="line">        <span class="keyword">if</span> (stepAction != <span class="keyword">null</span>) &#123;</span><br><span class="line">            stepAction.accept(step);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        step.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨è¯¥æ–¹æ³•</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707429794-d3d2255d-1a3e-4d5d-b7be-6d677f223c12.png#clientId=u3161bff8-e5eb-4&from=ui&id=u970a9c57&originHeight=116&originWidth=1394&originalType=binary&ratio=1&rotation=0&showTitle=false&size=18600&status=done&style=none&taskId=u7590f051-148b-4192-8d59-33a07f87943&title=" alt="10.png" loading="lazy"></p>
<p>ç„¶åæ¥åˆ°SimpleApplicationEventMulticasterï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ä¸‹é¢è¿™ä¸ªæ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¸­ï¼Œé‡è¦çš„æ˜¯Iterator var5 = this.getApplicationListeners(event, type).iterator();è·å–ç¬¦åˆeventTypeçš„ç›‘å¬å™¨çš„è¿­ä»£å™¨ã€‚æˆ‘ä»¬è¿›å…¥çœ‹ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">multicastEvent</span><span class="params">(ApplicationEvent event, <span class="meta">@Nullable</span> ResolvableType eventType)</span> </span>&#123;</span><br><span class="line">        ResolvableType type = eventType != <span class="keyword">null</span> ? eventType : <span class="keyword">this</span>.resolveDefaultEventType(event);</span><br><span class="line">        Executor executor = <span class="keyword">this</span>.getTaskExecutor();		<span class="comment">//null</span></span><br><span class="line">    </span><br><span class="line">    	</span><br><span class="line">        Iterator var5 = <span class="keyword">this</span>.getApplicationListeners(event, type).iterator();	<span class="comment">//é”šç‚¹5</span></span><br><span class="line">		</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">//ä»é”šç‚¹6å›æ¥ï¼Œéå†ç¬¦åˆæ¡ä»¶çš„ç›‘å¬å™¨ï¼Œå¹¶æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">while</span>(var5.hasNext()) &#123;</span><br><span class="line">            ApplicationListener&lt;?&gt; listener = (ApplicationListener)var5.next();</span><br><span class="line">            <span class="keyword">if</span> (executor != <span class="keyword">null</span>) &#123;</span><br><span class="line">                executor.execute(() -&gt; &#123;</span><br><span class="line">                    <span class="keyword">this</span>.invokeListener(listener, event);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//æ‰§è¡Œ</span></span><br><span class="line">                <span class="keyword">this</span>.invokeListener(listener, event);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>this.invokeListener(listener, event)æœ€åä¼šæ‰§è¡Œåˆ°è¿™é‡Œï¼Œæ ¹æ®ç›‘å¬å™¨æ‰§è¡Œä¸åŒçš„é€»è¾‘ã€‚</p>
<h4 id="é”šç‚¹5"><a href="#é”šç‚¹5" class="headerlink" title="é”šç‚¹5"></a>é”šç‚¹5</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Collection&lt;ApplicationListener&lt;?&gt;&gt; getApplicationListeners(ApplicationEvent event, ResolvableType eventType) &#123;</span><br><span class="line">        Object source = event.getSource();		<span class="comment">//åˆå§‹åŒ–åˆ›å»ºçš„SpringApplicationå¯¹è±¡</span></span><br><span class="line">        Class&lt;?&gt; sourceType = source != <span class="keyword">null</span> ? source.getClass() : <span class="keyword">null</span>;		<span class="comment">//SpringApplicationçš„å…¨é™å®šç±»å</span></span><br><span class="line">        AbstractApplicationEventMulticaster.ListenerCacheKey cacheKey = <span class="keyword">new</span> AbstractApplicationEventMulticaster.ListenerCacheKey(eventType, sourceType);		<span class="comment">//å°†eventTypeå’ŒsourceTypeå°è£…ä¸€ä¸ªkeyï¼Œåé¢è·å– existingRetriever</span></span><br><span class="line">        AbstractApplicationEventMulticaster.CachedListenerRetriever newRetriever = <span class="keyword">null</span>;</span><br><span class="line">        AbstractApplicationEventMulticaster.CachedListenerRetriever existingRetriever = (AbstractApplicationEventMulticaster.CachedListenerRetriever)<span class="keyword">this</span>.retrieverCache.get(cacheKey);		<span class="comment">//å› ä¸ºå¼€å§‹ç¼“å­˜æ²¡æœ‰ï¼Œæ‰€ä»¥æ˜¯nullï¼Œæ‰€ä»¥è¿›å…¥ä¸‹è¾¹çš„if</span></span><br><span class="line">        <span class="keyword">if</span> (existingRetriever == <span class="keyword">null</span> &amp;&amp; (<span class="keyword">this</span>.beanClassLoader == <span class="keyword">null</span> || ClassUtils.isCacheSafe(event.getClass(), <span class="keyword">this</span>.beanClassLoader) &amp;&amp; (sourceType == <span class="keyword">null</span> || ClassUtils.isCacheSafe(sourceType, <span class="keyword">this</span>.beanClassLoader)))) &#123;</span><br><span class="line">            <span class="comment">//å› ä¸ºç¬¬ä¸€æ¬¡retrieverCacheç¼“å­˜æ²¡æœ‰ï¼Œæ‰€ä»¥newäº†ä¸€ä¸ªnewRetrieverï¼Œç„¶åæ”¾å…¥ç¼“å­˜ï¼ŒcacheKeyä½œä¸ºkeyï¼ŒnewRetrieverä½œä¸ºå€¼</span></span><br><span class="line">            newRetriever = <span class="keyword">new</span> AbstractApplicationEventMulticaster.CachedListenerRetriever();</span><br><span class="line">            <span class="comment">//å› ä¸ºä¸å­˜åœ¨ï¼Œæ‰€ä»¥newRetrieverè¢«æ”¾å…¥ï¼Œè¿”å›nullï¼Œæ‰€ä»¥existingRetrieveræ˜¯null</span></span><br><span class="line">            existingRetriever = (AbstractApplicationEventMulticaster.CachedListenerRetriever)<span class="keyword">this</span>.retrieverCache.putIfAbsent(cacheKey, newRetriever);</span><br><span class="line">            <span class="keyword">if</span> (existingRetriever != <span class="keyword">null</span>) &#123;</span><br><span class="line">                newRetriever = <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//existingRetriever==null,ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (existingRetriever != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Collection&lt;ApplicationListener&lt;?&gt;&gt; result = existingRetriever.getApplicationListeners();		<span class="comment">//ç¬¦åˆæ¡ä»¶çš„ç›‘å¬å™¨é›†åˆï¼Œåˆ†æè§é”šç‚¹6</span></span><br><span class="line">            <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//è¿™ä¸€æ­¥ç­›é€‰ç¬¦åˆæ¡ä»¶çš„ç›‘å¬å™¨å¹¶è¿”å›ã€‚é”šç‚¹6</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.retrieveApplicationListeners(eventType, sourceType, newRetriever);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é”šç‚¹6"><a href="#é”šç‚¹6" class="headerlink" title="é”šç‚¹6"></a>é”šç‚¹6</h4><p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707447506-0c5e4a27-982e-40a7-a9f7-423686f75bbd.png#clientId=u3161bff8-e5eb-4&from=ui&id=ud927991f&originHeight=560&originWidth=1539&originalType=binary&ratio=1&rotation=0&showTitle=false&size=120459&status=done&style=none&taskId=uca59e8dd-4e97-4afb-b87f-ed96cde2820&title=" alt="11.png" loading="lazy"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Collection&lt;ApplicationListener&lt;?&gt;&gt; retrieveApplicationListeners(ResolvableType eventType, <span class="meta">@Nullable</span> Class&lt;?&gt; sourceType, <span class="meta">@Nullable</span> AbstractApplicationEventMulticaster.CachedListenerRetriever retriever) &#123;</span><br><span class="line">        List&lt;ApplicationListener&lt;?&gt;&gt; allListeners = <span class="keyword">new</span> ArrayList();</span><br><span class="line">        Set&lt;ApplicationListener&lt;?&gt;&gt; filteredListeners = retriever != <span class="keyword">null</span> ? <span class="keyword">new</span> LinkedHashSet() : <span class="keyword">null</span>;</span><br><span class="line">        Set&lt;String&gt; filteredListenerBeans = retriever != <span class="keyword">null</span> ? <span class="keyword">new</span> LinkedHashSet() : <span class="keyword">null</span>;</span><br><span class="line">        LinkedHashSet listeners;</span><br><span class="line">        LinkedHashSet listenerBeans;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.defaultRetriever) &#123;</span><br><span class="line">            <span class="comment">//æˆ‘ä»¬ é”šç‚¹3åˆ†æè¿‡ï¼Œthis.defaultRetriever.applicationListenerså­˜æ”¾çš„æ˜¯åŠ è½½classpathè·¯å¾„ä¸‹çš„9ä¸ªç›‘å¬å™¨</span></span><br><span class="line">            <span class="comment">//è¿™é‡ŒåŠ é”ï¼Œä¸ºäº†é˜²æ­¢åœ¨æ‰§è¡Œè¿™ä¸€æ­¥çš„åŒæ—¶å€¼è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹</span></span><br><span class="line">            listeners = <span class="keyword">new</span> LinkedHashSet(<span class="keyword">this</span>.defaultRetriever.applicationListeners);</span><br><span class="line">            listenerBeans = <span class="keyword">new</span> LinkedHashSet(<span class="keyword">this</span>.defaultRetriever.applicationListenerBeans);</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        Iterator var9 = listeners.iterator();</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">while</span>(var9.hasNext()) &#123;</span><br><span class="line">            ApplicationListener&lt;?&gt; listener = (ApplicationListener)var9.next();</span><br><span class="line">            <span class="comment">//é€šè¿‡æ–¹æ³•åå­—ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹ï¼Œå¦‚æœlistenerç¬¦åˆeventTypeå’ŒsourceTypeï¼Œé‚£ä¹ˆè¿”å›trueï¼Œæœ€ç»ˆæœ‰4ä¸ªç›‘å¬å™¨æ»¡è¶³</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.supportsEvent(listener, eventType, sourceType)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (retriever != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">//ç¬¬ä¸€æ¬¡åŠ å…¥filteredListeners</span></span><br><span class="line">                    filteredListeners.add(listener);</span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">//ç¬¦åˆæ¡ä»¶åŠ å…¥filteredListeners</span></span><br><span class="line">                allListeners.add(listener);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">//listenerBeanså¤§å°ä¸º0ï¼Œä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">if</span> (!listenerBeans.isEmpty()) &#123;</span><br><span class="line">            ConfigurableBeanFactory beanFactory = <span class="keyword">this</span>.getBeanFactory();</span><br><span class="line">            Iterator var16 = listenerBeans.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(var16.hasNext()) &#123;</span><br><span class="line">                String listenerBeanName = (String)var16.next();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.supportsEvent(beanFactory, listenerBeanName, eventType)) &#123;</span><br><span class="line">                        ApplicationListener&lt;?&gt; listener = (ApplicationListener)beanFactory.getBean(listenerBeanName, ApplicationListener.class);</span><br><span class="line">                        <span class="keyword">if</span> (!allListeners.contains(listener) &amp;&amp; <span class="keyword">this</span>.supportsEvent(listener, eventType, sourceType)) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (retriever != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (beanFactory.isSingleton(listenerBeanName)) &#123;</span><br><span class="line">                                    filteredListeners.add(listener);</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    filteredListenerBeans.add(listenerBeanName);</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            allListeners.add(listener);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        Object listener = beanFactory.getSingleton(listenerBeanName);</span><br><span class="line">                        <span class="keyword">if</span> (retriever != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            filteredListeners.remove(listener);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        allListeners.remove(listener);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (NoSuchBeanDefinitionException var13) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        AnnotationAwareOrderComparator.sort(allListeners);</span><br><span class="line">    	<span class="comment">//å°†è¿‡æ»¤çš„ç»“æœå­˜å…¥ç¼“å­˜ï¼Œä¸‹æ¬¡é€šè¿‡cacheKeyç›´æ¥è·å–</span></span><br><span class="line">        <span class="keyword">if</span> (retriever != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (filteredListenerBeans.isEmpty()) &#123;</span><br><span class="line">                retriever.applicationListeners = <span class="keyword">new</span> LinkedHashSet(allListeners);</span><br><span class="line">                retriever.applicationListenerBeans = filteredListenerBeans;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                retriever.applicationListeners = filteredListeners;</span><br><span class="line">                retriever.applicationListenerBeans = filteredListenerBeans;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">        <span class="keyword">return</span> allListeners;		<span class="comment">//é”šç‚¹6ç»“æŸï¼Œå›åˆ°é”šç‚¹4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é”šç‚¹7"><a href="#é”šç‚¹7" class="headerlink" title="é”šç‚¹7"></a>é”šç‚¹7</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span class="title">prepareEnvironment</span><span class="params">(SpringApplicationRunListeners listeners, DefaultBootstrapContext bootstrapContext, ApplicationArguments applicationArguments)</span> </span>&#123;</span><br><span class="line">    ConfigurableEnvironment environment = <span class="keyword">this</span>.getOrCreateEnvironment();		<span class="comment">//è·å–ç³»ç»Ÿé…ç½®ä¿¡æ¯ï¼Œä»¥åŠæ§åˆ¶å°é…ç½®</span></span><br><span class="line">    <span class="keyword">this</span>.configureEnvironment((ConfigurableEnvironment)environment, applicationArguments.getSourceArgs());</span><br><span class="line">    ConfigurationPropertySources.attach((Environment)environment);</span><br><span class="line">    listeners.environmentPrepared(bootstrapContext, (ConfigurableEnvironment)environment);		<span class="comment">//å¤„ç†ç¯å¢ƒå‡†å¤‡å®Œæˆç›¸å…³çš„ç›‘å¬å™¨ï¼Œè¿‡ç¨‹å‚è€ƒé”šç‚¹3åˆ°é”šç‚¹6ï¼Œä¸åŒçš„æ˜¯typeï¼Œå› æ­¤å¹¿æ’­çš„ç›‘å¬å™¨ä¸åŒã€‚</span></span><br><span class="line">    DefaultPropertiesPropertySource.moveToEnd((ConfigurableEnvironment)environment);</span><br><span class="line">    <span class="keyword">this</span>.configureAdditionalProfiles((ConfigurableEnvironment)environment);</span><br><span class="line">    <span class="keyword">this</span>.bindToSpringApplication((ConfigurableEnvironment)environment);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isCustomEnvironment) &#123;</span><br><span class="line">        environment = (<span class="keyword">new</span> EnvironmentConverter(<span class="keyword">this</span>.getClassLoader())).convertEnvironmentIfNecessary((ConfigurableEnvironment)environment, <span class="keyword">this</span>.deduceEnvironmentClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ConfigurationPropertySources.attach((Environment)environment);</span><br><span class="line">    <span class="keyword">return</span> (ConfigurableEnvironment)environment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿›å…¥getOrCreateEnvironmentæ–¹æ³•ï¼Œå› ä¸ºå¼€å§‹çš„æ—¶å€™ç¯å¢ƒæ˜¯ç©ºï¼Œæ‰€ä»¥è¿™é‡Œä¼šåˆ›å»ºStandardServletEnvironment()ï¼Œé‡Œé¢è¿›å»è¿™é‡Œä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼ŒStandardEnvironmentï¼ŒAbstractEnvironmentã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707474859-c2307092-dea0-4a59-9030-b6d7a7efc891.png#clientId=u3161bff8-e5eb-4&from=ui&id=uafc8dfd6&originHeight=423&originWidth=792&originalType=binary&ratio=1&rotation=0&showTitle=false&size=47346&status=done&style=none&taskId=u60b99c75-1935-4fc0-8994-43dd3c38443&title=" alt="12.png" loading="lazy"></p>
<p>æ‰€ä»¥æœ€ç»ˆè°ƒç”¨çš„æ˜¯AbstractEnvironmentçš„æ„é€ å™¨ï¼Œå…·ä½“é€»è¾‘ä¹Ÿæ˜¯åœ¨è¿™é‡Œæ‰§è¡Œçš„ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707490647-830ebee3-6783-4ea0-b317-f9b9ce5139b2.png#clientId=u3161bff8-e5eb-4&from=ui&id=uaab2e543&originHeight=32&originWidth=688&originalType=binary&ratio=1&rotation=0&showTitle=false&size=7838&status=done&style=none&taskId=ub8496735-f011-4947-a3ad-ad1d547476b&title=" alt="13.png" loading="lazy"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707498828-28acb6e4-8ac3-45fb-a32c-b31b7e0d4bc7.png#clientId=u3161bff8-e5eb-4&from=ui&id=ua5c48529&originHeight=39&originWidth=606&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8066&status=done&style=none&taskId=u4e32e7f0-566a-4e4e-806d-3b98c9c9c83&title=" alt="14.png" loading="lazy"></p>
<p>è¿™æ®µé€»è¾‘é‡Œé¢ï¼Œè¿›è¡Œäº†ä¸€äº›åˆå§‹å€¼çš„è®¾ç½®ï¼Œç„¶åå†æœ€åä¸€è¡Œä»£ç è¿›è¡Œäº†é‡è¦çš„æ“ä½œã€‚æœ€åä¸€è¡Œä»£ç æ‰§è¡Œçš„ä¸æ˜¯è¯¥ç±»çš„æ–¹æ³•ï¼Œè€Œæ˜¯StandardServletEnvironmentç±»çš„é‡å†™æ–¹æ³•ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707510183-f97be380-a42d-4f69-99a3-57f650af4262.png#clientId=u3161bff8-e5eb-4&from=ui&id=u8844aa9b&originHeight=358&originWidth=1068&originalType=binary&ratio=1&rotation=0&showTitle=false&size=59697&status=done&style=none&taskId=ua473673e-d44e-40bb-8b1e-044293a117a&title=" alt="22.png" loading="lazy"></p>
<p>StandardServletEnvironmentæ‰§è¡Œè¯¥æ–¹æ³•åï¼Œåˆè°ƒç”¨çˆ¶ç±»StandardEnvironmentçš„é‡å†™æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œè¿›è¡Œäº†ä¸€äº›åˆå€¼çš„è®¾ç½®ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707529571-bcf7bd22-c98d-4284-b382-632c9e2068a4.png#clientId=u3161bff8-e5eb-4&from=ui&id=u91b5dd06&originHeight=258&originWidth=984&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51082&status=done&style=none&taskId=ubd4c3bdd-302c-46b4-a390-72eb29d7a56&title=" alt="15.png" loading="lazy"></p>
<p>é‡ç‚¹åœ¨çˆ¶ç±»ä¸­ã€‚getSystemPropertiesæ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨System.getProperties()ï¼Œä»è¿™ä¸ªæ–¹æ³•é‡Œé¢å°±å¯ä»¥è·å–è®¡ç®—æœºç³»ç»Ÿçš„å±æ€§ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707544473-4a7247d1-2f0a-4674-874e-47577337e605.png#clientId=u3161bff8-e5eb-4&from=ui&id=ud5ef2459&originHeight=135&originWidth=1271&originalType=binary&ratio=1&rotation=0&showTitle=false&size=29198&status=done&style=none&taskId=ubb1ed218-f910-446a-aa2a-0ae27df636b&title=" alt="16.png" loading="lazy"></p>
<p>æ¥ä¸‹æ¥ä¼šæ‰§è¡Œè¿™ä¸€å¥ã€‚å…·ä½“ä½œç”¨å°±å¦‚åŒæ³¨é‡Šä¸€æ ·ã€‚å› ä¸ºåˆ°è¿™é‡Œç¯å¢ƒå‡†å¤‡çš„å·®ä¸å¤šäº†ï¼Œæ‰€ä»¥å°±è¦å¤„ç†ç¯å¢ƒå‡†å¤‡ä¹‹åçš„ä¸€äº›ç›‘å¬å™¨ã€‚å› æ­¤eventTypeç±»å‹æ˜¯ApplicationEnvironmentPreparedEventï¼Œæ‰¾åˆ°ä¹‹åè¿›è¡Œå¹¿æ’­ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707563730-c4f7e793-bd23-40a2-aae0-027b2c8bd126.png#clientId=u3161bff8-e5eb-4&from=ui&id=uea4aa363&originHeight=61&originWidth=1390&originalType=binary&ratio=1&rotation=0&showTitle=false&size=22110&status=done&style=none&taskId=u5aa1ea85-98f1-4bfa-90c0-4dec087f340&title=" alt="17.png" loading="lazy"></p>
<h4 id="é”šç‚¹8"><a href="#é”šç‚¹8" class="headerlink" title="é”šç‚¹8"></a>é”šç‚¹8</h4><p>webé¡¹ç›®ï¼Œä¼šåˆ›å»ºä¸€ä¸ªAnnotationConfigServletWebServerApplicationContext()ç±»ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707590869-0d1f8443-bc32-4fd7-ac5d-a8eb11dde247.png#clientId=u3161bff8-e5eb-4&from=ui&id=u1dbbdcc9&originHeight=183&originWidth=1126&originalType=binary&ratio=1&rotation=0&showTitle=false&size=39883&status=done&style=none&taskId=uba0cbcb7-df2d-42de-84b8-ec451180980&title=" alt="18.png" loading="lazy"></p>
<p>ä¹‹ååˆ›å»ºå¯åŠ¨å™¨ï¼Œåœ¨å‡†å¤‡éœ€è¦åˆ›å»ºçš„beansã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707599569-6f444165-c232-4ce8-b6c3-c51687a27704.png#clientId=u3161bff8-e5eb-4&from=ui&id=uf5b7e8ca&originHeight=62&originWidth=1133&originalType=binary&ratio=1&rotation=0&showTitle=false&size=20474&status=done&style=none&taskId=u42f24274-3f32-4e87-8a89-5688b3497c4&title=" alt="19.png" loading="lazy"></p>
<p>prepareContextä¸­ä¼šè°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå°†this.setInitializers(this.getSpringFactoriesInstances(ApplicationContextInitializer.class))è¿™ä¸ªåœ°æ–¹ä»é…ç½®ä¸­è¯»åˆ°çš„åˆå§‹åŒ–ç›¸å…³ç±»è¿›è¡Œéå†ï¼Œå¹¶ä¸”åˆå§‹åŒ–ã€‚åˆå§‹åŒ–å‰ä¼šè¿›è¡Œæ–­è¨€ï¼Œå¦‚æœä¸èƒ½åˆå§‹åŒ–åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>ä¹‹åä¼šæ‰§è¡Œç›¸åº”çš„ç›‘å¬å™¨ã€‚å¹¶ä¸”ä¼šæ³¨å†Œå•ä¾‹å¯¹è±¡çš„ç±»åã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707608284-3064f3fc-5ed6-4e5d-a094-559c16db09bf.png#clientId=u3161bff8-e5eb-4&from=ui&id=u7eed0658&originHeight=319&originWidth=1712&originalType=binary&ratio=1&rotation=0&showTitle=false&size=73412&status=done&style=none&taskId=u236e0f2b-54cd-447c-a8ba-7c7d60a3e84&title=" alt="20.png" loading="lazy"></p>
<p>prepareContextæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¼šè°ƒç”¨refreshContextæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šå°†å®¹å™¨çš„å¯¹è±¡åˆ·æ–°æ¿€æ´»ï¼Œä¹‹åå¤„ç†åˆ·æ–°ä¹‹åçš„æ“ä½œã€‚</p>
<p>åœ¨æ¿€æ´»å¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ·±å…¥ä¼šå‘ç°ï¼Œåœ¨refreshæ–¹æ³•ä¸­ï¼Œä¼šè°ƒç”¨onRefreshæ–¹æ³•ã€‚åœ¨è¿™ä¸ªåœ°æ–¹ä¼šå¯åŠ¨tomcatã€‚å¯åŠ¨tomcatä¹‹åè¿˜ä¼šåŠ è½½ä¸€äº›å…¶ä»–beanã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/12562230/1646707617233-4ffc6250-6293-4672-8c64-c1c9a34d96ad.png#clientId=u3161bff8-e5eb-4&from=ui&id=uc20fb555&originHeight=552&originWidth=1371&originalType=binary&ratio=1&rotation=0&showTitle=false&size=95295&status=done&style=none&taskId=u26738e0a-c446-465b-8551-93e0b101f0a&title=" alt="21.png" loading="lazy"></p>
<p>åˆ°æ­¤ï¼Œspringbootå¯åŠ¨å®Œæ¯•ã€‚</p>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>thetianxia</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="https://github.com/2023/06/29/SpringBoot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%202.4.5/" title="SpringBootå¯åŠ¨æµç¨‹---SpringApplicationç±»">https://github.com/2023/06/29/SpringBoot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%202.4.5/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> è®¸å¯åè®®ã€‚</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/blog/2023/07/02/ReentrantLock%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" rel="prev" title="ReentrantLockæºç åˆ†æ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">ReentrantLockæºç åˆ†æ</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/blog/2023/06/27/%E6%8A%A4%E7%BD%91/" rel="next" title="æŠ¤ç½‘"><span class="post-nav-text">æŠ¤ç½‘</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>è‹¥æ‚¨æœ‰ä»»ä½•æƒ³æ³•ï¼Œéƒ½å¯ä»¥ä¸æˆ‘äº¤æµã€‚</span><br></div><style>.utterances {
  max-width: 100%;
}</style><script src="https://utteranc.es/client.js" repo="owner/repo" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 â€“ 2023 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> the tianxia</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v5.4.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.2</span></div><div class="live_time"><span>åšæŒå°±æ˜¯èƒœåˆ©</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2021-10-27T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " å¤© " + passHour + " å°æ—¶ " + passMinute + " åˆ† " + passSecond + " ç§’";
}
blog_live_time();
</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>